<div class="picking-rx-container">
  <!-- Header -->
  <header class="picking-rx-header">
    <button
      class="back-button"
      (click)="onBackToHomepage()"
      aria-label="Volver al inicio"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="m15 18-6-6 6-6" />
      </svg>
    </button>

    <div class="header-content">
      <div class="app-icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect x="1" y="3" width="15" height="13" />
          <polygon points="16,8 20,8 23,11 23,16 16,16" />
          <circle cx="5.5" cy="18.5" r="2.5" />
          <circle cx="18.5" cy="18.5" r="2.5" />
        </svg>
      </div>
      <div class="header-text">
        <h1 class="app-title" *ngIf="pickingRxConfig">
          {{ pickingRxConfig.title }}
        </h1>
        <p class="app-subtitle" *ngIf="pickingRxConfig">
          {{ pickingRxConfig.subtitle }}
        </p>
      </div>
    </div>

    <div class="header-stats" *ngIf="pickingRxConfig">
      <div class="stats-item">
        <span class="stats-number">{{ pickingRxConfig.totalOrders }}</span>
        <span class="stats-label">Total Pedidos</span>
      </div>
    </div>
  </header>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p class="loading-text">Cargando datos...</p>
  </div>

  <!-- Main Content -->
  <main class="picking-rx-main" *ngIf="!isLoading && pickingRxConfig">
    <!-- Vista Principal - Todas las notas organizadas por estado -->
    <div class="status-overview">
      <div class="section-header">
        <h2 class="section-title">Notas de Entrega por Estado</h2>
        <p class="section-description">
          Gestión de pedidos organizados por estado
        </p>
      </div>

      <!-- Por cada estado visible, mostrar su sección -->
      <div
        *ngFor="let statusConfig of getVisibleStatusConfigs()"
        class="status-section"
      >
        <!-- Header de estado -->
        <div
          class="status-section-header"
          [style.border-left-color]="statusConfig.color"
        >
          <div class="status-info">
            <div class="status-icon-title">
              <div
                class="status-icon"
                [style.background-color]="statusConfig.color"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <!-- Íconos dinámicos según el tipo -->
                  <g *ngIf="statusConfig.icon === 'clock'">
                    <circle cx="12" cy="12" r="10" />
                    <polyline points="12,6 12,12 16,14" />
                  </g>
                  <g *ngIf="statusConfig.icon === 'package'">
                    <path d="m7.5 4.27 9 5.15" />
                    <path
                      d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"
                    />
                    <path d="m3.3 7 8.7 5 8.7-5" />
                    <path d="M12 22V12" />
                  </g>
                </svg>
              </div>
              <h3 class="status-title">{{ statusConfig.title }}</h3>
            </div>
            <div class="status-count" [style.color]="statusConfig.color">
              {{ statusConfig.count }}
              {{ statusConfig.count === 1 ? "pedido" : "pedidos" }}
            </div>
          </div>
        </div>

        <!-- Lista de notas para este estado -->
        <div
          class="delivery-notes-list"
          *ngIf="
            getDeliveryNotesByStatus(statusConfig.status).length > 0;
            else emptyStatusTemplate
          "
        >
          <div
            *ngFor="let note of getDeliveryNotesByStatus(statusConfig.status)"
            class="delivery-note-card"
            [class]="getPriorityClass(note.priority || 'low')"
            (click)="onDeliveryNoteClick(note)"
          >
            <div class="note-header">
              <div class="note-order-info">
                <h3 class="note-order-number">#{{ note.orderNumber }}</h3>
                <span
                  class="note-priority priority-{{ note.priority || 'low' }}"
                >
                  {{
                    (note.priority || "low") === "high"
                      ? "Alta"
                      : (note.priority || "low") === "medium"
                      ? "Media"
                      : "Baja"
                  }}
                </span>
              </div>
              <div class="note-time" *ngIf="note.createdAt">
                <span class="time-label">Creado:</span>
                <span class="time-value">{{ formatTime(note.createdAt) }}</span>
              </div>
            </div>

            <div class="note-content">
              <div class="note-summary">
                <p class="items-count">
                  {{ note.totalItems }}
                  {{ note.totalItems === 1 ? "producto" : "productos" }}
                </p>
              </div>
            </div>

            <div class="note-footer">
              <div class="note-actions">
                <button
                  class="action-button primary"
                  (click)="onDeliveryNoteClick(note); $event.stopPropagation()"
                  aria-label="Ver detalles del pedido"
                >
                  Ver Detalles
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado vacío para esta sección -->
        <ng-template #emptyStatusTemplate>
          <div class="empty-status-section">
            <div class="empty-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="48"
                height="48"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" />
                <path d="M3 6h18" />
                <path d="M16 10a4 4 0 0 1-8 0" />
              </svg>
            </div>
            <p class="empty-message">
              No hay pedidos {{ statusConfig.title.toLowerCase() }}
            </p>
          </div>
        </ng-template>
      </div>
    </div>
  </main>
</div>
